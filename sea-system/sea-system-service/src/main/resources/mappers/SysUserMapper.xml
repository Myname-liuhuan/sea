<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.sea.system.dao.SysUserMapper">
    <sql id="Base_Column_List">
        id,
        username, 
        mobile, 
        email, 
        avatar_url,
        profile, 
        is_banned,
        banned_until,
        create_time,
        update_time,
        create_by,
        update_by,
        del_flag
    </sql>

    <select id="list" resultType="com.example.sea.system.interfaces.vo.SysUserVO">
        SELECT 
        <include refid="Base_Column_List"/>
        FROM sys_user
        <where>
            <if test="username != null and username != ''">
                AND username LIKE CONCAT('%', #{username}, '%')
            </if>
             <if test="mobile != null and mobile != ''">
                AND mobile LIKE CONCAT('%', #{mobile}, '%')
            </if>
            <if test="email != null and email != ''">
                AND email LIKE CONCAT('%', #{email}, '%')
            </if>
           
        </where>
        ORDER BY create_time DESC
    </select>


    <select id="getRoleCodeByUserId" resultType="String">
        SELECT r.role_code
        FROM sys_user_role ur
        JOIN sys_role r ON ur.role_id = r.id
        WHERE ur.user_id = #{userId}
    </select>

    <select id="getPermsByUserId" resultType="String">
        SELECT sm.perms  
        FROM sys_role_menu srm
        JOIN sys_menu sm  ON srm.menu_id  = sm.id 
        JOIN sys_user_role sur ON srm.role_id  = sur.role_id 
        WHERE sur.user_id = #{userId}
    </select>

</mapper>
